<!--pages/user/orders/orders.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç­›é€‰æ  -->
  <view class="filter-bar">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="all">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="filter-item {{currentFilter === 'pending' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="pending">
        <text>å¾…æ¥å•</text>
      </view>
      <view class="filter-item {{currentFilter === 'accepted' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="accepted">
        <text>å·²æ¥å•</text>
      </view>
      <view class="filter-item {{currentFilter === 'confirmed' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="confirmed">
        <text>è¿›è¡Œä¸­</text>
      </view>
      <view class="filter-item {{currentFilter === 'completed' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="completed">
        <text>å¾…æ”¯ä»˜</text>
      </view>
      <view class="filter-item {{currentFilter === 'paid' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="paid">
        <text>å·²å®Œæˆ</text>
      </view>
      <view class="filter-item {{currentFilter === 'cancelled' ? 'active' : ''}}" bindtap="onFilterTap" data-filter="cancelled">
        <text>å·²å–æ¶ˆ</text>
      </view>
    </scroll-view>
  </view>

  <!-- å·¥å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="order-item" wx:for="{{orderList}}" wx:key="id" bindtap="onOrderTap" data-order="{{item}}">
      <!-- å·¥å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-info">
          <view class="order-title">{{item.serviceTypeName || 'ç”µå·¥ç»´ä¿®æœåŠ¡'}}</view>
          <view class="order-time">{{item.createTimeText}}</view>
        </view>
        <view class="order-status status-{{item.status}}">
          <text>{{item.statusText}}</text>
        </view>
      </view>

      <!-- å·¥å•å†…å®¹ -->
      <view class="order-content">
        <view class="order-address">
          <text class="address-icon">ğŸ“</text>
          <text class="address-text">{{item.address}}</text>
        </view>
        <view class="order-description">
          <text>{{item.description}}</text>
        </view>
        <view class="order-images" wx:if="{{item.images && item.images.length > 0}}">
          <image 
            class="order-image" 
            wx:for="{{item.images}}" 
            wx:for-item="image" 
            wx:key="*this"
            src="{{image}}" 
            mode="aspectFill"
            bindtap="onImageTap"
            data-images="{{item.images}}"
            data-current="{{image}}"
          ></image>
        </view>
      </view>

      <!-- ç”µå·¥ä¿¡æ¯ -->
      <view class="electrician-info" wx:if="{{item.electrician}}">
        <image class="electrician-avatar" src="{{item.electrician.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="electrician-details">
          <view class="electrician-name">{{item.electrician.name}}</view>
          <view class="electrician-rating">
            <text class="rating-text">{{item.electrician.rating}}</text>
            <text class="rating-stars">â­</text>
          </view>
        </view>
        <view class="contact-btn" bindtap="onContactElectrician" data-electrician="{{item.electrician}}" catchtap="true">
          <text>è”ç³»</text>
        </view>
      </view>

      <!-- å·¥å•åº•éƒ¨ -->
      <view class="order-footer">
        <view class="order-price" wx:if="{{item.amount}}">
          <text class="price-label">ç»´ä¿®è´¹ç”¨ï¼š</text>
          <text class="price-value">Â¥{{item.amount}}</text>
        </view>
        <view class="order-actions">
          <!-- å¾…æ¥å•çŠ¶æ€ -->
          <view class="action-buttons" wx:if="{{item.status === 'pending'}}">
            <button class="action-btn cancel-btn" bindtap="onCancelOrder" data-order="{{item}}" catchtap="true">
              å–æ¶ˆå·¥å•
            </button>
          </view>
          
          <!-- å·²æ¥å•çŠ¶æ€ -->
          <view class="action-buttons" wx:if="{{item.status === 'accepted'}}">
            <button class="action-btn contact-btn" bindtap="onContactElectrician" data-electrician="{{item.electrician}}" catchtap="true">
              è”ç³»ç”µå·¥
            </button>
          </view>
          
          <!-- è¿›è¡Œä¸­çŠ¶æ€ -->
          <view class="action-buttons" wx:if="{{item.status === 'confirmed'}}">
            <button class="action-btn contact-btn" bindtap="onContactElectrician" data-electrician="{{item.electrician}}" catchtap="true">
              è”ç³»ç”µå·¥
            </button>
          </view>
          
          <!-- å¾…æ”¯ä»˜çŠ¶æ€ -->
          <view class="action-buttons" wx:if="{{item.status === 'completed'}}">
            <button class="action-btn secondary-btn" bindtap="onViewRepairDetail" data-order="{{item}}" catchtap="true">
              æŸ¥çœ‹ç»´ä¿®è¯¦æƒ…
            </button>
            <button class="action-btn primary-btn" bindtap="onPayOrder" data-order="{{item}}" catchtap="true">
              ç«‹å³æ”¯ä»˜
            </button>
          </view>
          
          <!-- å·²å®ŒæˆçŠ¶æ€ -->
          <view class="action-buttons" wx:if="{{item.status === 'paid'}}">
            <button class="action-btn secondary-btn" bindtap="onViewRepairDetail" data-order="{{item}}" catchtap="true">
              æŸ¥çœ‹ç»´ä¿®è¯¦æƒ…
            </button>
            <button class="action-btn primary-btn" wx:if="{{!item.hasEvaluated}}" bindtap="onEvaluateOrder" data-order="{{item}}" catchtap="true">
              è¯„ä»·æœåŠ¡
            </button>
            <button class="action-btn secondary-btn" wx:else bindtap="onViewEvaluation" data-order="{{item}}" catchtap="true">
              æŸ¥çœ‹è¯„ä»·
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{orderList.length === 0 && !loading}}">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">{{currentFilter === 'all' ? 'æš‚æ— å·¥å•' : 'æš‚æ— ç›¸å…³å·¥å•'}}</view>
      <button class="empty-action-btn" bindtap="onCreateOrder" wx:if="{{currentFilter === 'all'}}">
        ç«‹å³ä¸‹å•
      </button>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-icon">â³</view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && orderList.length > 0}}">
      <view class="load-more-text" wx:if="{{loadingMore}}">åŠ è½½ä¸­...</view>
      <view class="load-more-text" wx:else>ä¸Šæ‹‰åŠ è½½æ›´å¤š</view>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && orderList.length > 0}}">
      <view class="no-more-text">æ²¡æœ‰æ›´å¤šå·¥å•äº†</view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
</view>

<!-- å¿«é€Ÿæ“ä½œæµ®åŠ¨æŒ‰é’® -->
<view class="fab" bindtap="onCreateOrder">
  <text class="fab-icon">+</text>
</view>