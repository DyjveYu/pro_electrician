<!--pages/user/profile/profile.wxml-->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card">
    <view class="user-header">
      <image class="user-avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill" bindtap="onChangeAvatar"></image>
      <view class="user-info">
        <view class="user-name">{{userInfo.name || '未设置昵称'}}</view>
        <view class="user-phone">{{userInfo.phone || '未绑定手机'}}</view>
        <view class="user-level">
          <text class="level-badge">{{userInfo.level || '普通用户'}}</text>
        </view>
      </view>
      <view class="user-actions">
        <button class="edit-btn" bindtap="onEditProfile">
          <text class="edit-icon">✏️</text>
        </button>
      </view>
    </view>
    
    <!-- 用户统计 -->
    <view class="user-stats">
      <view class="stat-item" bindtap="onViewOrders">
        <view class="stat-number">{{userStats.totalOrders || 0}}</view>
        <view class="stat-label">总工单</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="onViewOrders" data-filter="completed">
        <view class="stat-number">{{userStats.completedOrders || 0}}</view>
        <view class="stat-label">已完成</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="onViewCoupons">
        <view class="stat-number">{{userStats.availableCoupons || 0}}</view>
        <view class="stat-label">优惠券</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="onViewPoints">
        <view class="stat-number">{{userStats.points || 0}}</view>
        <view class="stat-label">积分</view>
      </view>
    </view>
  </view>

  <!-- 快捷操作 -->
  <view class="quick-actions">
    <view class="action-item" bindtap="onCreateOrder">
      <view class="action-icon">🔧</view>
      <view class="action-text">立即下单</view>
    </view>
    <view class="action-item" bindtap="onViewOrders" data-filter="pending">
      <view class="action-icon">⏳</view>
      <view class="action-text">待接单</view>
    </view>
    <view class="action-item" bindtap="onViewOrders" data-filter="confirmed">
      <view class="action-icon">🔄</view>
      <view class="action-text">进行中</view>
    </view>
    <view class="action-item" bindtap="onViewOrders" data-filter="completed">
      <view class="action-icon">💰</view>
      <view class="action-text">待支付</view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="section-title">我的服务</view>
    <view class="menu-list">
      <view class="menu-item" bindtap="onViewOrders">
        <view class="menu-icon">📋</view>
        <view class="menu-content">
          <view class="menu-title">我的工单</view>
          <view class="menu-desc">查看所有工单记录</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewAddresses">
        <view class="menu-icon">📍</view>
        <view class="menu-content">
          <view class="menu-title">地址管理</view>
          <view class="menu-desc">管理常用服务地址</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewCoupons">
        <view class="menu-icon">🎫</view>
        <view class="menu-content">
          <view class="menu-title">优惠券</view>
          <view class="menu-desc">查看可用优惠券</view>
        </view>
        <view class="menu-badge" wx:if="{{userStats.availableCoupons > 0}}">{{userStats.availableCoupons}}</view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewPoints">
        <view class="menu-icon">⭐</view>
        <view class="menu-content">
          <view class="menu-title">积分中心</view>
          <view class="menu-desc">积分兑换和记录</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
    </view>
  </view>

  <!-- 工具菜单 -->
  <view class="menu-section">
    <view class="section-title">工具与帮助</view>
    <view class="menu-list">
      <view class="menu-item" bindtap="onViewFavorites">
        <view class="menu-icon">❤️</view>
        <view class="menu-content">
          <view class="menu-title">收藏的电工</view>
          <view class="menu-desc">查看收藏的电工师傅</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewEvaluations">
        <view class="menu-icon">💬</view>
        <view class="menu-content">
          <view class="menu-title">我的评价</view>
          <view class="menu-desc">查看历史评价记录</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onContactService">
        <view class="menu-icon">📞</view>
        <view class="menu-content">
          <view class="menu-title">联系客服</view>
          <view class="menu-desc">在线客服和意见反馈</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewHelp">
        <view class="menu-icon">❓</view>
        <view class="menu-content">
          <view class="menu-title">帮助中心</view>
          <view class="menu-desc">常见问题和使用指南</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
    </view>
  </view>

  <!-- 设置菜单 -->
  <view class="menu-section">
    <view class="section-title">设置</view>
    <view class="menu-list">
      <view class="menu-item" bindtap="onViewSettings">
        <view class="menu-icon">⚙️</view>
        <view class="menu-content">
          <view class="menu-title">账户设置</view>
          <view class="menu-desc">个人信息和隐私设置</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewNotifications">
        <view class="menu-icon">🔔</view>
        <view class="menu-content">
          <view class="menu-title">消息通知</view>
          <view class="menu-desc">推送和提醒设置</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
      
      <view class="menu-item" bindtap="onViewAbout">
        <view class="menu-icon">ℹ️</view>
        <view class="menu-content">
          <view class="menu-title">关于我们</view>
          <view class="menu-desc">版本信息和用户协议</view>
        </view>
        <view class="menu-arrow">›</view>
      </view>
    </view>
  </view>

  <!-- 切换角色 -->
  <view class="role-switch" wx:if="{{!userInfo.isElectrician}}">
    <view class="switch-card">
      <view class="switch-content">
        <view class="switch-icon">👷</view>
        <view class="switch-info">
          <view class="switch-title">成为电工师傅</view>
          <view class="switch-desc">加入我们，开始接单赚钱</view>
        </view>
      </view>
      <button class="switch-btn" bindtap="onApplyElectrician">
        立即申请
      </button>
    </view>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section">
    <button class="logout-btn" bindtap="onLogout">
      退出登录
    </button>
  </view>

  <!-- 安全区域 -->
  <view class="safe-area-bottom"></view>
</view>

<!-- 加载状态 -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-icon">⏳</view>
    <view class="loading-text">加载中...</view>
  </view>
</view>

<!-- 头像选择弹窗 -->
<view class="avatar-modal" wx:if="{{showAvatarModal}}" bindtap="onCloseAvatarModal">
  <view class="avatar-content" catchtap="stopPropagation">
    <view class="avatar-title">选择头像</view>
    <view class="avatar-options">
      <button class="avatar-option" bindtap="onChooseFromAlbum">
        <text class="option-icon">📷</text>
        <text class="option-text">从相册选择</text>
      </button>
      <button class="avatar-option" bindtap="onTakePhoto">
        <text class="option-icon">📸</text>
        <text class="option-text">拍照</text>
      </button>
    </view>
    <button class="avatar-cancel" bindtap="onCloseAvatarModal">
      取消
    </button>
  </view>
</view>