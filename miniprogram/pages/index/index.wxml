<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input" bindtap="onSearchTap">
      <text class="iconfont icon-search">ğŸ”</text>
      <text class="search-placeholder">æœç´¢ç”µå·¥æœåŠ¡</text>
    </view>
    <view class="location-btn" bindtap="onLocationTap">
      <text class="iconfont icon-location">ğŸ“</text>
      <text class="location-text">{{currentAddress || 'å®šä½ä¸­...'}}</text>
    </view>
    <!-- å¼€å‘è€…å…¥å£ -->
    <view class="dev-btn" bindtap="onDevTestTap" wx:if="{{showDevEntry}}">
      <text class="dev-icon">ğŸ”§</text>
    </view>
  </view>

  <!-- ç”¨æˆ·ç±»å‹åˆ‡æ¢ -->
  <view class="user-type-switch" wx:if="{{userInfo}}">
    <view class="switch-item {{userType === 'user' ? 'active' : ''}}" bindtap="switchToUser">
      <text class="switch-text">æˆ‘è¦æ‰¾ç”µå·¥</text>
    </view>
    <view class="switch-item {{userType === 'electrician' ? 'active' : ''}}" bindtap="switchToElectrician">
      <text class="switch-text">æˆ‘æ˜¯ç”µå·¥</text>
    </view>
  </view>

  <!-- ç”¨æˆ·ç«¯å†…å®¹ -->
  <view class="user-content" wx:if="{{userType === 'user'}}">
    <!-- æœåŠ¡åˆ†ç±» -->
    <view class="service-categories">
      <view class="section-title">æœåŠ¡åˆ†ç±»</view>
      <view class="category-grid">
        <view class="category-item" wx:for="{{serviceCategories}}" wx:key="id" bindtap="onCategoryTap" data-category="{{item}}">
          <view class="category-icon">{{item.icon}}</view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- å¿«é€Ÿä¸‹å• -->
    <view class="quick-order">
      <view class="section-title">å¿«é€Ÿä¸‹å•</view>
      <view class="order-card" bindtap="onQuickOrderTap">
        <view class="order-content">
          <view class="order-title">ç´§æ€¥ç”µå·¥æœåŠ¡</view>
          <view class="order-desc">24å°æ—¶å“åº”ï¼Œä¸“ä¸šç”µå·¥ä¸Šé—¨æœåŠ¡</view>
        </view>
        <view class="order-btn">
          <text>ç«‹å³ä¸‹å•</text>
        </view>
      </view>
    </view>

    <!-- é™„è¿‘ç”µå·¥ -->
    <view class="nearby-electricians">
      <view class="section-title">
        <text>é™„è¿‘ç”µå·¥</text>
        <text class="more-btn" bindtap="onMoreElectriciansTap">æ›´å¤š</text>
      </view>
      <scroll-view class="electrician-list" scroll-x="true">
        <view class="electrician-item" wx:for="{{nearbyElectricians}}" wx:key="id" bindtap="onElectricianTap" data-electrician="{{item}}">
          <image class="electrician-avatar" src="{{item.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="electrician-info">
            <view class="electrician-name">{{item.name}}</view>
            <view class="electrician-rating">
              <text class="rating-text">{{item.rating}}</text>
              <text class="rating-stars">â­â­â­â­â­</text>
            </view>
            <view class="electrician-distance">{{item.distanceText}}</view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æˆ‘çš„å·¥å• -->
    <view class="my-orders">
      <view class="section-title">
        <text>æˆ‘çš„å·¥å•</text>
        <text class="more-btn" bindtap="onMoreOrdersTap">æ›´å¤š</text>
      </view>
      <view class="order-list">
        <view class="order-item" wx:for="{{myOrders}}" wx:key="id" bindtap="onOrderTap" data-order="{{item}}">
          <view class="order-header">
            <view class="order-title">{{item.title}}</view>
            <view class="order-status status-{{item.status}}">{{item.statusText}}</view>
          </view>
          <view class="order-info">
            <view class="order-time">{{item.createTimeText}}</view>
            <view class="order-price">Â¥{{item.price}}</view>
          </view>
        </view>
        <view class="empty-state" wx:if="{{myOrders.length === 0}}">
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æš‚æ— å·¥å•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”µå·¥ç«¯å†…å®¹ -->
  <view class="electrician-content" wx:if="{{userType === 'electrician'}}">
    <!-- å·¥ä½œçŠ¶æ€ -->
    <view class="work-status">
      <view class="status-card">
        <view class="status-header">
          <text class="status-title">å·¥ä½œçŠ¶æ€</text>
          <switch class="status-switch" checked="{{isWorking}}" bindchange="onWorkStatusChange"></switch>
        </view>
        <view class="status-info">
          <text class="status-text">{{isWorking ? 'æ¥å•ä¸­' : 'ä¼‘æ¯ä¸­'}}</text>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥æ•°æ® -->
    <view class="today-stats">
      <view class="section-title">ä»Šæ—¥æ•°æ®</view>
      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-number">{{todayStats.orders}}</view>
          <view class="stat-label">æ¥å•æ•°</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">Â¥{{todayStats.income}}</view>
          <view class="stat-label">æ”¶å…¥</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{todayStats.rating}}</view>
          <view class="stat-label">è¯„åˆ†</view>
        </view>
      </view>
    </view>

    <!-- å¯æ¥å·¥å• -->
    <view class="available-orders">
      <view class="section-title">
        <text>å¯æ¥å·¥å•</text>
        <text class="refresh-btn" bindtap="onRefreshOrdersTap">ğŸ”„</text>
      </view>
      <view class="order-list">
        <view class="order-item" wx:for="{{availableOrders}}" wx:key="id" bindtap="onAvailableOrderTap" data-order="{{item}}">
          <view class="order-header">
            <view class="order-title">{{item.title}}</view>
            <view class="order-price">Â¥{{item.price}}</view>
          </view>
          <view class="order-info">
            <view class="order-location">ğŸ“ {{item.address}}</view>
            <view class="order-distance">{{item.distanceText}}</view>
          </view>
          <view class="order-time">{{item.createTimeText}}</view>
        </view>
        <view class="empty-state" wx:if="{{availableOrders.length === 0}}">
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æš‚æ— å¯æ¥å·¥å•</text>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„å·¥å• -->
    <view class="my-work-orders">
      <view class="section-title">
        <text>æˆ‘çš„å·¥å•</text>
        <text class="more-btn" bindtap="onMoreWorkOrdersTap">æ›´å¤š</text>
      </view>
      <view class="order-list">
        <view class="order-item" wx:for="{{myWorkOrders}}" wx:key="id" bindtap="onWorkOrderTap" data-order="{{item}}">
          <view class="order-header">
            <view class="order-title">{{item.title}}</view>
            <view class="order-status status-{{item.status}}">{{item.statusText}}</view>
          </view>
          <view class="order-info">
            <view class="order-location">ğŸ“ {{item.address}}</view>
            <view class="order-time">{{item.createTimeText}}</view>
          </view>
        </view>
        <view class="empty-state" wx:if="{{myWorkOrders.length === 0}}">
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æš‚æ— å·¥å•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-prompt" wx:if="{{!userInfo}}">
    <view class="prompt-card">
      <view class="prompt-icon">ğŸ‘‹</view>
      <view class="prompt-title">æ¬¢è¿ä½¿ç”¨ç”µå·¥ç»´ä¿®å¹³å°</view>
      <view class="prompt-desc">è¯·å…ˆç™»å½•ä»¥äº«å—å®Œæ•´æœåŠ¡</view>
      <button class="login-btn" bindtap="onLoginTap">ç«‹å³ç™»å½•</button>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-area-bottom"></view>