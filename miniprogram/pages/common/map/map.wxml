<!--åœ°å›¾é€‰æ‹©é¡µé¢-->
<view class="map-container">
  <!-- åœ°å›¾ç»„ä»¶ -->
  <map 
    id="map" 
    class="map-view"
    longitude="{{longitude}}"
    latitude="{{latitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    show-location="{{true}}"
    bindregionchange="onRegionChange"
    bindtap="onMapTap"
    bindmarkertap="onMarkerTap"
  >
    <!-- ä¸­å¿ƒç‚¹æ ‡è®° -->
    <cover-view class="map-center-marker">
      <cover-image class="marker-icon" src="/images/map-marker.png"></cover-image>
    </cover-view>
    
    <!-- å®šä½æŒ‰é’® -->
    <cover-view class="location-btn" bindtap="onGetLocation">
      <cover-image class="location-icon" src="/images/location-icon.png"></cover-image>
    </cover-view>
  </map>

  <!-- æœç´¢æ  -->
  <view class="search-container">
    <view class="search-box">
      <view class="search-icon">ğŸ”</view>
      <input 
        class="search-input" 
        placeholder="æœç´¢åœ°ç‚¹" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        focus="{{searchFocus}}"
      />
      <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="onClearSearch">
        <text class="clear-icon">Ã—</text>
      </view>
    </view>
    
    <!-- æœç´¢å»ºè®® -->
    <view wx:if="{{searchSuggestions.length > 0}}" class="search-suggestions">
      <view 
        wx:for="{{searchSuggestions}}" 
        wx:key="id" 
        class="suggestion-item"
        bindtap="onSelectSuggestion"
        data-item="{{item}}"
      >
        <view class="suggestion-icon">ğŸ“</view>
        <view class="suggestion-content">
          <text class="suggestion-title">{{item.title}}</text>
          <text class="suggestion-address">{{item.address}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°å€ä¿¡æ¯å¡ç‰‡ -->
  <view class="address-card">
    <view class="card-header">
      <view class="address-icon">ğŸ“</view>
      <text class="card-title">é€‰æ‹©çš„ä½ç½®</text>
    </view>
    
    <view class="address-info">
      <view class="address-main">
        <text class="address-name">{{selectedAddress.name || 'æœªçŸ¥ä½ç½®'}}</text>
      </view>
      <view class="address-detail">
        <text class="address-text">{{selectedAddress.address || 'æ­£åœ¨è·å–åœ°å€...'}}</text>
      </view>
    </view>
    
    <!-- é™„è¿‘åœ°ç‚¹ -->
    <view wx:if="{{nearbyPlaces.length > 0}}" class="nearby-places">
      <view class="nearby-title">é™„è¿‘åœ°ç‚¹</view>
      <scroll-view class="nearby-list" scroll-x="{{true}}">
        <view 
          wx:for="{{nearbyPlaces}}" 
          wx:key="id" 
          class="nearby-item nearby-{{item.selected ? 'selected' : 'normal'}}"
          bindtap="onSelectNearbyPlace"
          data-item="{{item}}"
        >
          <view class="nearby-icon">{{item.icon}}</view>
          <text class="nearby-name">{{item.name}}</text>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view class="action-buttons">
      <button class="cancel-btn" bindtap="onCancel">
        <text class="btn-text">å–æ¶ˆ</text>
      </button>
      <button class="confirm-btn" bindtap="onConfirm" disabled="{{!selectedAddress.address}}">
        <text class="btn-text">ç¡®å®š</text>
      </button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">{{loadingText}}</text>
    </view>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view wx:if="{{showError}}" class="error-toast">
    <view class="error-content">
      <view class="error-icon">âš ï¸</view>
      <text class="error-text">{{errorMessage}}</text>
    </view>
  </view>
</view>